{
  "_id": "{{@ system @}}",
  "oauth2": {
    "access_token": "$SECRET(oauth_access_token)",
    "client_id": "$SECRET(oauth_client_id)",
    "client_secret": "$SECRET(oauth_client_secret)",
    "refresh_token": "$SECRET(oauth_refresh_token)",
    "token_url": "{{@ token_url @}}"
  },
  "operations": {
    "alternate_list": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "GET",
      "url": "{{ properties.base_url }}"
    },
    "contact-webhook-insert": {
      "method": "POST",
      "payload": {
        "Events": [
          "contact.created",
          "contact.changed",
          "contact.deleted"
        ],
        "State": "Active",
        "TargetUrl": "{{@ service_url @}}/receivers/{{@ system @}}-contact-event/entities",
        "Type": "webhook"
      },
      "payload-type": "json",
      "url": "Webhook"
    },
    "defaults": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "GET",
      "url": "{{ properties.base_url }}"
    },
    "delete": {
      "method": "DELETE",
      "url": "{{ properties.base_url }}/{{ entity[properties.lookup_id] }}"
    },
    "insert": {
      "method": "POST",
      "url": "{{ properties.base_url }}"
    },
    "list": {
      "headers": {
        "Accept": "application/json",
        "SO-TimeZone": "includeTZOffset"
      },
      "id_expression": "{{ PrimaryKey }}",
      "method": "GET",
      "next_page_link": "{{@ base_url @}}/{{@ account_id @}}/api/v1/{{ properties.base_url }}",
      "next_page_termination_strategy": [
        "same-next-page-request",
        "empty-result"
      ],
      "params": {
        "$filter": "{% if since is defined and since is not none %}({{ properties.updated_param }} afterTime '{{ since }}'){% else %}({{ properties.updated_param }} afterTime '1970-01-01T00:00:00'){% endif %}",
        "$orderby": "{{ properties.primary_key }}",
        "$skip": "{{ 1000|int*page }}",
        "$top": "1000"
      },
      "payload_property": "value",
      "url": "{{ properties.base_url }}"
    },
    "lookup": {
      "headers": {
        "Accept": "application/json",
        "SO-TimeZone": "includeTZOffset"
      },
      "method": "GET",
      "url": "{{ properties.base_url }}/{{ entity[properties.lookup_id] }}"
    },
    "lookup-from-list": {
      "headers": {
        "Accept": "application/json",
        "SO-TimeZone": "includeTZOffset"
      },
      "id_expression": "{{ properties.primary_key|string }}",
      "method": "GET",
      "url": "{{ properties.base_url }}/{{ entity[properties.list_id] }}"
    },
    "ownercontactlink-list": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "GET",
      "payload_property": "value",
      "url": "archive/dynamic?$select=ownercontactlink.contact_id,ownercontactlink.contact_id.name"
    },
    "person-webhook-insert": {
      "method": "POST",
      "payload": {
        "Events": [
          "person.created",
          "person.changed",
          "person.deleted",
          "person.consented",
          "person.unconsented"
        ],
        "State": "Active",
        "TargetUrl": "{{@ service_url @}}/receivers/{{@ system @}}-person-event/entities",
        "Type": "webhook"
      },
      "payload-type": "json",
      "url": "Webhook"
    },
    "project-webhook-insert": {
      "method": "POST",
      "payload": {
        "Events": [
          "project.created",
          "project.changed",
          "project.deleted"
        ],
        "State": "Active",
        "TargetUrl": "{{@ service_url @}}/receivers/{{@ system @}}-project-event/entities",
        "Type": "webhook"
      },
      "payload-type": "json",
      "url": "Webhook"
    },
    "put-update": {
      "method": "PUT",
      "url": "{{ properties.base_url }}/{{ entity[properties.lookup_id] }}"
    },
    "quote-lookup": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "payload": {
        "QuoteId": "{{ entity['quote/quoteId'] }}"
      },
      "url": "Agents/Quote/GetQuoteEntity"
    },
    "quote-webhook-insert": {
      "method": "POST",
      "payload": {
        "Events": [
          "quote.approved",
          "quote.rejected",
          "quote.sent",
          "quote.ordered"
        ],
        "State": "Active",
        "TargetUrl": "{{@ service_url @}}/receivers/{{@ system @}}-quote-event/entities",
        "Type": "webhook"
      },
      "payload-type": "json",
      "url": "Webhook"
    },
    "quotealternative-create": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "payload": {
        "QuoteVersionId": "{{ entity['$source']['QuoteVersionId'] }}"
      },
      "url": "Agents/Quote/CreateQuoteAlternative"
    },
    "quotealternative-default": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "url": "Agents/Quote/CreateDefaultQuoteAlternative"
    },
    "quotealternative-lookup": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "url": "Agents/Quote/GetQuoteAlternative?quoteAlternativeId={{ entity['QuoteAlternativeId'] }}"
    },
    "quotealternative-sale-lookup": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "payload": {
        "SaleId": "{{ entity['sesam_SaleId'] }}"
      },
      "url": "Agents/Quote/GetQuoteFromSaleId"
    },
    "quotealternative-save": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "url": "Agents/Quote/SaveQuoteAlternative"
    },
    "quotealternative-save-quote": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "url": "Agents/Quote/SaveQuote"
    },
    "quotealternative-save-quoteversion": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "url": "Agents/Quote/SaveQuoteVersion"
    },
    "quoteline-default": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "payload": {
        "ERPProductKey": "{{ entity['$source']['ERPProductKey'] }}",
        "QuoteAlternativeId": "{{ entity['$source']['QuoteAlternativeId'] }}"
      },
      "url": "Agents/Quote/CreateQuoteLine"
    },
    "quoteline-delete": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "payload": {
        "QuoteLineId": "{{ entity['QuoteLineId'] }}"
      },
      "url": "Agents/Quote/DeleteQuoteLine"
    },
    "quoteline-insert": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "url": "Agents/Quote/SaveQuoteLine"
    },
    "quoteline-list": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "payload": {
        "QuoteAlternativeId": "{{ entity['QuoteAlternativeId'] }}"
      },
      "url": "Agents/Quote/GetQuoteLines"
    },
    "quoteline-lookup": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "payload": {
        "QuoteLineId": "{{ entity['QuoteLineId'] }}"
      },
      "url": "Agents/Quote/GetQuoteLine"
    },
    "quoteline-update": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "url": "Agents/Quote/SaveQuoteLine"
    },
    "quoteversion-lookup": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "POST",
      "payload": {
        "QuoteId": "{{ entity['QuoteId'] }}"
      },
      "url": "Agents/Quote/GetQuoteVersions"
    },
    "sale-webhook-insert": {
      "method": "POST",
      "payload": {
        "Events": [
          "sale.created",
          "sale.changed",
          "sale.deleted",
          "sale.completed",
          "sale.lost",
          "sale.sold"
        ],
        "State": "Active",
        "TargetUrl": "{{@ service_url @}}/receivers/{{@ system @}}-sale-event/entities",
        "Type": "webhook"
      },
      "payload-type": "json",
      "url": "Webhook"
    },
    "salequote-list": {
      "headers": {
        "Accept": "application/json",
        "X-Sesam-Page": "{% if (previous_request_headers is defined and previous_request_headers['X-Sesam-Page'] is defined) %}{{ previous_request_headers['X-Sesam-Page']|int + 1 }}{% else %}1{% endif %}"
      },
      "id_expression": "{{ PrimaryKey }}",
      "method": "GET",
      "next_page_link": "{{@ base_url @}}/{{@ account_id @}}/api/v1/archive/Sale?$select=saleId,quote/quoteId,quote/connectionId,updatedDate",
      "next_page_termination_strategy": [
        "same-next-page-request",
        "empty-result"
      ],
      "params": {
        "$filter": "{% if since is defined and since is not none %}(updatedDate afterTime '{{ since }}'){% else %}(updatedDate afterTime '1970-01-01T00:00:00'){% endif %}",
        "$orderby": "PrimaryKey asc",
        "$skip": "{% if (previous_request_headers['X-Sesam-Page'] is defined) %}{{ 1000|int*(headers['X-Sesam-Page']|int-1) }}{% else %}0{% endif %}sesam:markjson",
        "$top": "1000"
      },
      "payload_property": "value",
      "url": "archive/Sale?$select=quote/quoteId,updatedDate"
    },
    "ticket-webhook-insert": {
      "method": "POST",
      "payload": {
        "Events": [
          "ticket.created",
          "ticket.changed"
        ],
        "State": "Active",
        "TargetUrl": "{{@ service_url @}}/receivers/{{@ system @}}-ticket-event/entities",
        "Type": "webhook"
      },
      "payload-type": "json",
      "url": "Webhook"
    },
    "update": {
      "method": "PATCH",
      "url": "{{ properties.base_url }}/{{ entity[properties.lookup_id] }}"
    },
    "user_list": {
      "headers": {
        "Accept": "application/json"
      },
      "method": "GET",
      "next_page_link": "{{@ base_url @}}/{{@ account_id @}}/api/v1/{{ properties.base_url }}",
      "next_page_termination_strategy": [
        "same-next-page-request",
        "empty-result"
      ],
      "params": {
        "$orderby": "{{ properties.primary_key }}",
        "$skip": "{{ 1000|int*page }}",
        "$top": "1000"
      },
      "url": "{{ properties.base_url }}"
    },
    "webhook-delete": {
      "method": "DELETE",
      "payload-type": "json",
      "url": "Webhook/{{ entity['WebhookId'] }}"
    },
    "webhook-insert": {
      "method": "POST",
      "payload-type": "json",
      "url": "Webhook"
    },
    "webhook-list": {
      "id_expression": "{{ WebhookId }}",
      "method": "GET",
      "url": "Webhook"
    },
    "webhook-lookup": {
      "method": "GET",
      "payload-type": "json",
      "url": "Webhook/{{ entity['WebhookId'] }}"
    }
  },
  "rate_limiting_delay": 60,
  "rate_limiting_retries": 3,
  "type": "system:rest",
  "url_pattern": "{{@ base_url @}}/{{@ account_id @}}/api/v1/%s",
  "verify_ssl": true
}